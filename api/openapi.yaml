openapi: 3.0.4
info:
  description: "Este microservicio gestiona el contenido multimedia y comercial del\
    \ proyecto \"UnderSounds\", incluyendo albumes, canciones, generos, merchandising\
    \ y noticias musicales."
  title: Microservicio de Contenido - UnderSounds
  version: 1.1.0
servers:
- url: /
tags:
- description: Operaciones relacionadas con los albumes musicales.
  name: Albumes
- description: Operaciones relacionadas con las canciones.
  name: Canciones
- description: Consultas de generos musicales.
  name: Generos
- description: Gestion de productos de merchandising.
  name: Merchandising
- description: Gestion y consulta de noticias musicales.
  name: Noticias
- description: Busqueda global de contenido.
  name: Busqueda
- description: Procesamiento de pedidos y pagos.
  name: Pedidos
paths:
  /albums:
    get:
      parameters:
      - description: Filtrar albumes por ID de artista
        example: 3
        explode: true
        in: query
        name: artista
        required: false
        schema:
          type: integer
        style: form
      responses:
        "200":
          content:
            application/json:
              example:
              - id: 1
                nombre: Indie Vibes
                duracion: 2535
                imagen: null
                fecha: 2024-09-15
                genero:
                  id: 1
                  nombre: Indie
                artista: 1
                precio: 9.99
              schema:
                items:
                  $ref: "#/components/schemas/Album"
                type: array
          description: Lista de albumes obtenida correctamente
        "404":
          description: Albumes no encontrados
      summary: Listar todos los albumes (con filtro opcional por artista)
      tags:
      - Albumes
    post:
      requestBody:
        content:
          application/json:
            example:
              nombre: Electro Beats
              duracion: 2300
              imagen: null
              fecha: 2025-01-10
              genero: 3
              artista: 3
              precio: 12.99
              formato: 1
            schema:
              $ref: "#/components/schemas/CreateAlbumRequest"
        required: true
      responses:
        "201":
          description: Album creado correctamente
        "400":
          description: Datos de entrada invalidos
      summary: Crear un nuevo album
      tags:
      - Albumes
  /albums/{id}:
    delete:
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
      responses:
        "204":
          description: Album eliminado correctamente
        "404":
          description: Album no encontrado
      summary: Eliminar un album
      tags:
      - Albumes
    get:
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
      responses:
        "200":
          content:
            application/json:
              example:
                id: 1
                nombre: Indie Vibes
                duracion: 2535
                imagen: null
                fecha: 2024-09-15
                genero:
                  id: 1
                  nombre: Indie
                artista: 1
                precio: 9.99
              schema:
                $ref: "#/components/schemas/Album"
          description: Album encontrado
        "404":
          description: Album no encontrado
      summary: Obtener detalles de un album
      tags:
      - Albumes
    patch:
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateAlbumRequest"
        required: true
      responses:
        "200":
          description: Album actualizado correctamente
        "404":
          description: Album no encontrado
      summary: Actualizar un album existente
      tags:
      - Albumes
  /albums/{id}/detalle:
    get:
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
      responses:
        "200":
          content:
            application/json:
              example:
                id: 1
                nombre: Indie Vibes
                duracion: "42:15"
                fecha: 2024-09-15
                genero:
                  id: 1
                  nombre: Indie
                artista: 1
                nombreArtista: "Nombre del Artista"
                precio: 9.99
                canciones:
                - id: 1
                  nombre: Sunrise
                  duracion: "3:45"
                  album: 1
              schema:
                $ref: "#/components/schemas/AlbumDetalle"
          description: Detalles completos del album con canciones
        "404":
          description: Album no encontrado
      summary: Obtener detalles completos de un album incluyendo canciones
      tags:
      - Albumes
  /albums/{id}/imagen:
    get:
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
      responses:
        "200":
          content:
            image/jpeg:
              schema:
                type: string
                format: binary
            image/png:
              schema:
                type: string
                format: binary
          description: Imagen del album
        "404":
          description: Album o imagen no encontrados
      summary: Obtener la imagen de un album
      tags:
      - Albumes
  /canciones:
    get:
      responses:
        "200":
          content:
            application/json:
              example:
              - id: 1
                nombre: Sunrise
                duracion: "3:45"
                album: 1
              schema:
                items:
                  $ref: "#/components/schemas/Cancion"
                type: array
          description: Lista de canciones
        "404":
          description: No se encontraron canciones
      summary: Listar todas las canciones
      tags:
      - Canciones
    post:
      requestBody:
        content:
          application/json:
            example:
              nombre: Starlight
              duracion: "3:55"
              album: 2
              archivoAudio: null
            schema:
              $ref: "#/components/schemas/Cancion"
        required: true
      responses:
        "201":
          description: Cancion creada correctamente
        "400":
          description: Datos de entrada invalidos
      summary: Crear una nueva cancion
      tags:
      - Canciones
  /canciones/album/{id}:
    get:
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
        description: ID del album
      responses:
        "200":
          content:
            application/json:
              example:
              - id: 1
                nombre: Sunrise
                duracion: "3:45"
                album: 1
              schema:
                items:
                  $ref: "#/components/schemas/Cancion"
                type: array
          description: Lista de canciones del album
        "404":
          description: Album no encontrado
      summary: Obtener todas las canciones de un album
      tags:
      - Canciones
  /canciones/{id}:
    delete:
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
      responses:
        "204":
          description: Cancion eliminada correctamente
        "404":
          description: Cancion no encontrada
      summary: Eliminar una cancion
      tags:
      - Canciones
    get:
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
      responses:
        "200":
          content:
            application/json:
              example:
                id: 1
                nombre: Sunrise
                duracion: "3:45"
                album: 1
              schema:
                $ref: "#/components/schemas/Cancion"
          description: Cancion encontrada
        "404":
          description: Cancion no encontrada
      summary: Obtener detalles de una cancion
      tags:
      - Canciones
    patch:
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Cancion"
        required: true
      responses:
        "200":
          description: Cancion actualizada correctamente
        "404":
          description: Cancion no encontrada
      summary: Actualizar datos de una cancion
      tags:
      - Canciones
  /canciones/{id}/verAutores:
    get:
      description: Devuelve una lista con los IDs de los artistas que han interpretado
        la cancion especificada.
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VerAutoresCancion"
          description: Autores de la cancion obtenidos exitosamente
        "404":
          description: Cancion no encontrada
      summary: Obtener los artistas de una cancion
      tags:
      - Canciones
  /canciones/{id}/archivo:
    get:
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
      responses:
        "200":
          content:
            audio/mpeg:
              schema:
                type: string
                format: binary
          description: Archivo de audio de la cancion
        "404":
          description: Cancion o archivo de audio no encontrados
      summary: Obtener el archivo de audio de una cancion
      tags:
      - Canciones
  /generos:
    get:
      responses:
        "200":
          content:
            application/json:
              example:
              - id: 1
                nombre: Indie
              - id: 2
                nombre: Rock
              schema:
                items:
                  $ref: "#/components/schemas/Genero"
                type: array
          description: Lista de generos
        "404":
          description: Generos no encontrados
      summary: Listar todos los generos musicales
      tags:
      - Generos
  /merch:
    get:
      responses:
        "200":
          content:
            application/json:
              example:
              - id: 1
                nombre: Camiseta Indie Vibes
                precio: 25.0
                imagen: null
                artista: 1
                stock: 50
              schema:
                items:
                  $ref: "#/components/schemas/Merch"
                type: array
          description: Lista de productos de merchandising
      summary: Listar todos los productos de merchandising
      tags:
      - Merchandising
    post:
      requestBody:
        content:
          application/json:
            example:
              nombre: Sudadera Electro Beats
              precio: 35.0
              imagen: null
              artista: 3
              stock: 20
            schema:
              $ref: "#/components/schemas/CreateMerchRequest"
        required: true
      responses:
        "201":
          description: Producto creado correctamente
        "400":
          description: Datos de entrada invalidos
      summary: Crear un nuevo producto de merchandising
      tags:
      - Merchandising
  /merch/{id}:
    delete:
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
      responses:
        "204":
          description: Producto eliminado correctamente
        "404":
          description: Producto no encontrado
      summary: Eliminar un producto
      tags:
      - Merchandising
    get:
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
      responses:
        "200":
          content:
            application/json:
              example:
                id: 1
                nombre: Camiseta Indie Vibes
                precio: 25.0
                imagen: null
                artista: 1
                stock: 50
              schema:
                $ref: "#/components/schemas/Merch"
          description: Producto encontrado
        "404":
          description: Producto no encontrado
      summary: Obtener un producto de merchandising
      tags:
      - Merchandising
    patch:
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateMerchRequest"
        required: true
      responses:
        "200":
          description: Producto actualizado correctamente
        "404":
          description: Producto no encontrado
      summary: Actualizar un producto
      tags:
      - Merchandising
  /merch/{id}/recargarStockMerch:
    patch:
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RecargarStockMerch"
        required: true
      responses:
        "200":
          description: Stock incrementado correctamente
        "400":
          description: Datos de entrada invalidos
        "404":
          description: Producto no encontrado
      summary: Aumentar la cantidad disponible de un producto
      tags:
      - Merchandising
  /merch/{id}/disminuirStockMerch:
    patch:
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DisminuirStockMerch"
        required: true
      responses:
        "200":
          description: Stock decrementado correctamente
        "400":
          description: Datos de entrada invalidos
        "404":
          description: Producto no encontrado
      summary: Disminuir la cantidad disponible de un producto
      tags:
      - Merchandising
  /noticias:
    get:
      responses:
        "200":
          content:
            application/json:
              example:
              - id: 1
                titulo: Nuevo album Indie Vibes lanzado
                contenidoHTML: <p>El esperado album Indie Vibes ya esta disponible.</p>
                fecha: "2024-09-15"
                autor: 1
                nombreAutor: "Nombre del Autor"
              schema:
                items:
                  $ref: "#/components/schemas/Noticia"
                type: array
          description: Lista de noticias ordenadas por fecha descendente
        "404":
          description: No se encontraron noticias
      summary: Listar noticias recientes
      tags:
      - Noticias
    post:
      requestBody:
        content:
          application/json:
            example:
              titulo: Lanzamiento de Electro Beats
              contenidoHTML: <p>El nuevo album Electro Beats estara disponible desde
                enero.</p>
              fecha: "2025-01-10"
              autor: 3
            schema:
              $ref: "#/components/schemas/Noticia"
        required: true
      responses:
        "201":
          description: Noticia creada correctamente
        "400":
          description: Datos de entrada invalidos
      summary: Crear una nueva noticia
      tags:
      - Noticias
  /noticias/{id}:
    get:
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
      responses:
        "200":
          content:
            application/json:
              example:
                id: 1
                titulo: Nuevo album Indie Vibes lanzado
                contenidoHTML: <p>El esperado album Indie Vibes ya esta disponible.</p>
                fecha: "2024-09-15"
                autor: 1
                nombreAutor: "Nombre del Autor"
              schema:
                $ref: "#/components/schemas/Noticia"
          description: Noticia encontrada
        "404":
          description: Noticia no encontrada
      summary: Obtener una noticia especifica
      tags:
      - Noticias
    delete:
      parameters:
      - explode: false
        in: path
        name: id
        required: true
        schema:
          type: integer
        style: simple
      responses:
        "204":
          description: Noticia eliminada correctamente
        "404":
          description: Noticia no encontrada
      summary: Eliminar una noticia
      tags:
      - Noticias
  /busqueda:
    get:
      parameters:
      - description: Texto de búsqueda para filtrar por nombre
        explode: true
        in: query
        name: q
        required: false
        schema:
          type: string
        style: form
      - description: Filtrar por género (ID o nombre)
        explode: true
        in: query
        name: genero
        required: false
        schema:
          type: string
        style: form
      - description: Filtrar por formato de album (ID o nombre)
        explode: true
        in: query
        name: formato
        required: false
        schema:
          type: string
        style: form
      - description: Tipo de búsqueda (albumes, canciones, merch, artistas)
        explode: true
        in: query
        name: type
        required: false
        schema:
          type: string
          enum: [albumes, canciones, merch, merchandising, artistas]
        style: form
      - description: Número de página
        explode: true
        in: query
        name: page
        required: false
        schema:
          type: integer
          default: 1
        style: form
      - description: Resultados por página (máximo 100)
        explode: true
        in: query
        name: per_page
        required: false
        schema:
          type: integer
          default: 10
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SearchResponse"
          description: Resultados de búsqueda
      summary: Búsqueda global de contenido
      tags:
      - Busqueda
  /pedido/pago:
    post:
      requestBody:
        content:
          application/json:
            example:
              cliente_id: 1
              producto:
                id: 1
                tipo: "digital"
                cantidad: 1
              pago:
                tipo: "tarjeta"
                numero: "1234567890123456"
                cvv: "123"
                expiracion: "12/25"
            schema:
              $ref: "#/components/schemas/PedidoRequest"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PedidoResponse"
          description: Pedido procesado correctamente
        "400":
          description: Datos de entrada invalidos o stock insuficiente
      summary: Procesar un pedido y pago
      tags:
      - Pedidos
components:
  schemas:
    Album:
      example:
        fecha: "2024-09-15"
        artista: 1
        genero:
          id: 1
          nombre: Indie
        duracion: 2535
        id: 1
        nombre: Indie Vibes
        imagen: null
        precio: 9.99
      properties:
        id:
          example: 1
          type: integer
        nombre:
          example: Indie Vibes
          type: string
        duracion:
          example: 2535
          type: integer
          description: Duracion en segundos
        imagen:
          type: string
          format: byte
          description: Imagen del album en formato binario (BYTEA)
        fecha:
          example: "2024-09-15"
          format: date
          type: string
        genero:
          $ref: "#/components/schemas/Genero"
        artista:
          example: 1
          type: integer
        precio:
          example: 9.99
          type: number
          format: float
      required:
      - artista
      - genero
      - nombre
      - precio
      type: object
    CreateAlbumRequest:
      properties:
        nombre:
          type: string
          example: Indie Vibes
        duracion:
          type: integer
          description: Duracion en segundos (opcional)
          example: 2535
        imagen:
          type: string
          format: byte
          description: Imagen del album en formato binario
        fecha:
          type: string
          format: date
          example: "2024-09-15"
        genero:
          type: integer
          example: 1
        artista:
          type: integer
          example: 1
        precio:
          type: number
          format: float
          example: 9.99
        formato:
          type: integer
          description: ID del formato (opcional, por defecto Digital con ID 1)
          example: 1
      required:
      - nombre
      - genero
      - artista
      - precio
      type: object
    UpdateAlbumRequest:
      properties:
        nombre:
          type: string
        duracion:
          type: integer
          description: Duracion en segundos
        imagen:
          type: string
          format: byte
        fecha:
          type: string
          format: date
        genero:
          type: integer
        artista:
          type: integer
        precio:
          type: number
          format: float
      type: object
    AlbumDetalle:
      properties:
        id:
          type: integer
          example: 1
        nombre:
          type: string
          example: Indie Vibes
        duracion:
          type: string
          description: Duracion en formato MM:SS
          example: "42:15"
        fecha:
          type: string
          format: date
          example: "2024-09-15"
        genero:
          $ref: "#/components/schemas/Genero"
        artista:
          type: integer
          example: 1
        nombreArtista:
          type: string
          example: "Nombre del Artista"
        precio:
          type: number
          format: float
          example: 9.99
        canciones:
          items:
            $ref: "#/components/schemas/Cancion"
          type: array
      type: object
    Cancion:
      example:
        album: 1
        duracion: "3:45"
        id: 1
        nombre: Sunrise
        archivoAudio: null
      properties:
        id:
          example: 1
          type: integer
        nombre:
          example: Sunrise
          type: string
        duracion:
          example: "3:45"
          type: string
          description: Duracion en formato MM:SS
        album:
          example: 1
          type: integer
        archivoAudio:
          type: string
          format: byte
          description: Archivo de audio en formato binario (BYTEA)
      required:
      - nombre
      - duracion
      type: object
    Genero:
      example:
        id: 1
        nombre: Indie
      properties:
        id:
          example: 1
          type: integer
        nombre:
          example: Indie
          type: string
      required:
      - nombre
      type: object
    Merch:
      example:
        precio: 25.0
        artista: 1
        id: 1
        stock: 50
        nombre: Camiseta Indie Vibes
        imagen: null
        nombre_artista: "Nombre del Artista"
      properties:
        id:
          example: 1
          type: integer
        nombre:
          example: Camiseta Indie Vibes
          type: string
        precio:
          example: 25.0
          format: float
          type: number
        imagen:
          type: string
          format: byte
          description: Imagen del producto en formato binario (BYTEA)
        artista:
          example: 1
          type: integer
        nombre_artista:
          type: string
          example: "Nombre del Artista"
          description: Nombre del artista (obtenido del microservicio de usuarios)
        stock:
          example: 50
          type: integer
      required:
      - artista
      - nombre
      - precio
      - stock
      type: object
    CreateMerchRequest:
      properties:
        nombre:
          type: string
          example: Camiseta Indie Vibes
        precio:
          type: number
          format: float
          example: 25.0
        imagen:
          type: string
          format: byte
          description: Imagen del producto en formato binario
        artista:
          type: integer
          example: 1
        stock:
          type: integer
          example: 50
      required:
      - nombre
      - precio
      - artista
      - stock
      type: object
    UpdateMerchRequest:
      properties:
        nombre:
          type: string
        precio:
          type: number
          format: float
        imagen:
          type: string
          format: byte
        artista:
          type: integer
        stock:
          type: integer
      type: object
    Noticia:
      example:
        fecha: "2024-09-15"
        contenidoHTML: <p>El esperado album Indie Vibes ya esta disponible.</p>
        titulo: Nuevo album Indie Vibes lanzado
        id: 1
        autor: 1
        nombreAutor: "Nombre del Autor"
      properties:
        id:
          example: 1
          type: integer
        titulo:
          example: Nuevo album Indie Vibes lanzado
          type: string
        contenidoHTML:
          example: <p>El esperado album Indie Vibes ya esta disponible.</p>
          type: string
        fecha:
          example: "2024-09-15"
          type: string
          description: Fecha en formato ISO 8601
        autor:
          example: 1
          type: integer
        nombreAutor:
          type: string
          example: "Nombre del Autor"
          description: Nombre del autor (obtenido del microservicio de usuarios)
      required:
      - autor
      - contenidoHTML
      - titulo
      type: object
    RecargarStockMerch:
      properties:
        cantidad:
          description: Nueva cantidad a sumar del producto
          type: integer
      required:
      - cantidad
      type: object
    DisminuirStockMerch:
      properties:
        cantidad:
          description: Nueva cantidad a restar del producto
          type: integer
      required:
      - cantidad
      type: object
    VerAutoresCancion:
      example:
        idCancion: 1
        artistas:
        - 6
        - 7
      properties:
        idCancion:
          description: ID de la cancion
          type: integer
        artistas:
          items:
            type: integer
          type: array
      required:
      - artistas
      - idCancion
      type: object
    SearchResponse:
      properties:
        page:
          type: integer
          description: Número de página actual
          example: 1
        per_page:
          type: integer
          description: Resultados por página
          example: 10
        totals:
          type: object
          description: Totales de cada tipo de resultado
          additionalProperties:
            type: integer
          example:
            albumes: 5
            canciones: 10
            merch: 3
            artistas: 2
        results:
          type: object
          description: Resultados de búsqueda por tipo
          additionalProperties:
            type: array
            items:
              type: object
      type: object
    AlbumResult:
      properties:
        id:
          type: integer
        nombre:
          type: string
        duracion:
          type: integer
          description: Duracion en segundos
        imagen:
          type: string
          description: Imagen en formato base64
        fecha:
          type: string
        genero:
          type: integer
        artista:
          type: integer
        nombre_artista:
          type: string
        precio:
          type: number
          format: float
        formatos:
          type: array
          items:
            type: integer
      type: object
    CancionResult:
      properties:
        id:
          type: integer
        nombre:
          type: string
        duracion:
          type: integer
          description: Duracion en segundos
        album:
          type: integer
      type: object
    ArtistResult:
      properties:
        id:
          type: integer
        nombre:
          type: string
        albums_count:
          type: integer
        songs_count:
          type: integer
        merch_count:
          type: integer
      type: object
    PedidoRequest:
      properties:
        cliente_id:
          type: integer
          example: 1
        producto:
          $ref: "#/components/schemas/ProductoPedido"
        pago:
          $ref: "#/components/schemas/Pago"
      required:
      - cliente_id
      - producto
      - pago
      type: object
    ProductoPedido:
      properties:
        id:
          type: integer
          description: ID del producto (album o merchandising)
          example: 1
        tipo:
          type: string
          enum: [fisico, digital]
          description: Tipo de producto (fisico para merch, digital para albumes)
          example: "digital"
        cantidad:
          type: integer
          description: Cantidad solicitada
          example: 1
      required:
      - id
      - tipo
      - cantidad
      type: object
    Pago:
      properties:
        tipo:
          type: string
          example: "tarjeta"
        numero:
          type: string
          description: Número de tarjeta (16 dígitos)
          example: "1234567890123456"
        cvv:
          type: string
          example: "123"
        expiracion:
          type: string
          example: "12/25"
      required:
      - tipo
      - numero
      - cvv
      - expiracion
      type: object
    PedidoResponse:
      properties:
        mensaje:
          type: string
          example: "Compra confirmada correctamente. Gracias por tu pedido."
        total:
          type: number
          format: float
          example: 9.99
      type: object
